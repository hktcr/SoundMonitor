<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ljudmonitor — Klassrumsverktyg</title>
    <meta name="description"
        content="Realtids-ljudmonitor för klassrummet. Mäter och loggar ljudvolym med visuell graf, streak-counter och sessionsrapporter.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Aurora background -->
    <canvas id="auroraCanvas" class="aurora-canvas"></canvas>
    <div class="ambient-glow" id="ambientGlow"></div>

    <!-- ===== MAIN VIEW ===== -->
    <div class="container" id="mainView">
        <header>
            <h1><img src="icons/microphone.png" alt="" class="header-icon"> Ljudmonitor</h1>
            <p>Klassrumsverktyg — mäter och loggar ljudvolym i realtid</p>
        </header>

        <!-- VU Meter + Stats + Streak -->
        <div class="card" id="vuCard">
            <div class="vu-section">
                <div class="vu-meter-container">
                    <div class="vu-ring" id="vuRing"></div>
                    <div class="vu-inner">
                        <span class="vu-value" id="vuValue">—</span>
                        <span class="vu-label">Relativ <span class="vu-unit">dB</span></span>
                    </div>
                </div>
                <div class="stats-streak-col">
                    <div class="streak-display" id="streakDisplay">
                        <img src="icons/fire.png" alt="" class="streak-icon-img">
                        <div class="streak-time" id="streakTime">0:00</div>
                        <div class="streak-progress-container">
                            <div class="streak-progress-bar" id="streakProgressBar"></div>
                            <div class="streak-progress-label" id="streakProgressLabel">0/10s</div>
                        </div>
                        <div class="streak-label">STREAK</div>
                        <div class="streak-best" id="streakBest"></div>
                    </div>
                    <div class="stats-panel">
                        <div class="stat-item">
                            <span class="stat-label">Snitt</span>
                            <span class="stat-value" id="statAvg">—</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Topp</span>
                            <span class="stat-value" id="statPeak">—</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Över tröskel</span>
                            <span class="stat-value" id="statOver">—</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Status</span>
                            <span id="statusBadge" class="status-badge inactive">
                                <span class="status-dot"></span>
                                <span id="statusText">Inaktiv</span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Activity Phases -->
        <div class="card phase-card">
            <div class="phase-header">
                <span class="control-label">Aktivitetsfas</span>
                <span class="phase-hint" id="phaseHint">Ingen fas vald</span>
            </div>
            <div class="phase-buttons">
                <button class="phase-btn" data-phase="none" onclick="setPhase('none')" aria-label="Ingen fas">
                    <img src="icons/pause.png" alt="" class="phase-icon-img"><span class="phase-text">Ingen</span>
                </button>
                <button class="phase-btn" data-phase="lecture" onclick="setPhase('lecture')" aria-label="Genomgång">
                    <img src="icons/lecture.png" alt="" class="phase-icon-img"><span class="phase-text">Genomgång</span>
                </button>
                <button class="phase-btn" data-phase="quiet" onclick="setPhase('quiet')" aria-label="Tyst arbete">
                    <!-- SVG pencil icon for quiet work -->
                    <svg class="phase-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 3a2.85 2.85 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" />
                        <path d="m15 5 4 4" />
                    </svg>
                    <span class="phase-text">Tyst arbete</span>
                </button>
                <button class="phase-btn" data-phase="discussion" onclick="setPhase('discussion')"
                    aria-label="Diskussion">
                    <img src="icons/discussion.png" alt="" class="phase-icon-img"><span
                        class="phase-text">Diskussion</span>
                </button>
            </div>

            <!-- Fine-tuning panel (shown after calibration) -->
            <div class="phase-fine-tune" id="phaseTune">
                <div class="tune-item">
                    <span class="tune-label">Tyst arbete</span>
                    <input type="range" id="tuneQuiet" min="-10" max="10" value="0" step="1">
                    <span class="tune-value" id="tuneQuietValue">35 dB</span>
                </div>
                <div class="tune-item">
                    <span class="tune-label">Genomgång</span>
                    <input type="range" id="tuneLecture" min="-10" max="10" value="0" step="1">
                    <span class="tune-value" id="tuneLectureValue">50 dB</span>
                </div>
                <div class="tune-item">
                    <span class="tune-label">Diskussion</span>
                    <input type="range" id="tuneDiscussion" min="-10" max="10" value="0" step="1">
                    <span class="tune-value" id="tuneDiscussionValue">60 dB</span>
                </div>
            </div>
        </div>

        <!-- Graph -->
        <div class="card graph-section">
            <div class="graph-header">
                <span class="graph-title">
                    <svg class="inline-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round">
                        <path d="M3 3v18h18" />
                        <path d="m7 16 4-8 4 4 4-6" />
                    </svg>
                    Volymhistorik
                </span>
                <span class="graph-time" id="graphTimeLabel">Senaste 60 sekunder</span>
            </div>
            <div class="graph-legend" id="graphLegend"></div>
            <canvas id="volumeGraph"></canvas>
        </div>

        <!-- Controls -->
        <div class="card">
            <div class="controls-grid">
                <div class="control-group">
                    <span class="control-label">Tröskel (relativ dB)</span>
                    <div class="slider-container">
                        <input type="range" id="thresholdSlider" min="1" max="100" value="50">
                        <span class="slider-value" id="thresholdValue">50</span>
                    </div>
                    <div class="threshold-hint" id="thresholdHint">Justeras automatiskt vid fasval</div>
                </div>
                <div class="control-group">
                    <span class="control-label">Varningsljud</span>
                    <div class="toggle-row">
                        <span class="toggle-label-text">Spela ljud vid överskridning</span>
                        <label class="toggle">
                            <input type="checkbox" id="soundToggle">
                            <div class="toggle-track"></div>
                            <div class="toggle-thumb"></div>
                        </label>
                    </div>
                    <div class="cooldown-bar" id="cooldownBar">
                        <div class="cooldown-fill" id="cooldownFill"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="card">
            <div class="action-bar">
                <button class="btn btn-primary" id="startBtn" onclick="toggleRecording()">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                        <polygon points="6,3 20,12 6,21" />
                    </svg>
                    <span id="startLabel">Starta mätning</span>
                </button>
                <button class="btn btn-calibrate" id="calibrateBtn" onclick="calibrate()" disabled>
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10" />
                        <circle cx="12" cy="12" r="6" />
                        <circle cx="12" cy="12" r="2" />
                    </svg>
                    Kalibrera tyst nivå
                </button>
                <button class="btn btn-secondary" id="fullscreenBtn" onclick="enterFullscreen()">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round">
                        <path
                            d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3" />
                    </svg>
                    Fullskärm
                </button>
                <button class="btn btn-secondary" id="historyBtn" onclick="showHistory()">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <path d="M14 2v6h6" />
                        <path d="M16 13H8" />
                        <path d="M16 17H8" />
                    </svg>
                    Historik
                </button>
                <button class="btn btn-secondary" id="resetBtn" onclick="resetStats()">
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                        <path d="M3 3v5h5" />
                    </svg>
                    Nollställ
                </button>
            </div>
            <p class="calibration-msg" id="calibrationMsg"></p>
        </div>

        <footer>
            Ljudmonitor v2.1 — Del av <a href="#">GAIA Klassrumsverktyg</a> · Data sparas bara på denna dator
        </footer>
    </div>

    <!-- ===== FULLSCREEN VIEW ===== -->
    <div class="fullscreen-view hidden" id="fullscreenView">
        <div class="fs-exit" onclick="exitFullscreen()" title="Avsluta fullskärm">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                width="24" height="24">
                <path d="M18 6 6 18" />
                <path d="m6 6 12 12" />
            </svg>
        </div>

        <div class="fs-content">
            <!-- Header: Phase indicator + Session time -->
            <div class="fs-header">
                <div class="fs-phase-indicator" id="fsPhaseIndicator">
                    <span class="fs-phase-label">INGEN FAS</span>
                    <span class="fs-threshold-hint">Ingen tröskel</span>
                </div>
                <div class="fs-session-time" id="fsSessionTime">
                    Sessionstid: 0:00
                </div>
            </div>

            <!-- Main: Graph + Streak/Stats -->
            <div class="fs-main">
                <div class="fs-graph-section">
                    <div class="fs-current-level" id="fsCurrentLevel">
                        <span class="fs-current-value" id="fsCurrentValue">—</span>
                        <span class="fs-current-unit">dB</span>
                    </div>
                    <canvas id="fsGraphCanvas" class="fs-graph-canvas"></canvas>
                </div>

                <div class="fs-sidebar">
                    <div class="fs-streak" id="fsStreak">
                        <img src="icons/fire.png" alt="" class="fs-streak-icon-img">
                        <span class="fs-streak-time" id="fsStreakTime">0:00</span>
                        <span class="fs-streak-label">STREAK</span>
                    </div>

                    <div class="fs-stats">
                        <div class="fs-stat-item">
                            <span class="fs-stat-label">SNITT</span>
                            <span class="fs-stat-value" id="fsStatAvg">—</span>
                        </div>
                        <div class="fs-stat-item">
                            <span class="fs-stat-label">TOPP</span>
                            <span class="fs-stat-value" id="fsStatPeak">—</span>
                        </div>
                        <div class="fs-stat-item">
                            <span class="fs-stat-label">ÖVER TRÖSKEL</span>
                            <span class="fs-stat-value" id="fsStatOver">—</span>
                        </div>
                    </div>

                    <div class="fs-adjust-panel" id="fsAdjustPanel">
                        <div class="fs-adjust-header">FINJUSTERA</div>
                        <div class="fs-tune-item">
                            <label>Tyst arbete <span id="fsVal-quiet">0</span></label>
                            <input type="range" id="fsTune-quiet" min="-10" max="10" value="0">
                        </div>
                        <div class="fs-tune-item">
                            <label>Genomgång <span id="fsVal-lecture">0</span></label>
                            <input type="range" id="fsTune-lecture" min="-10" max="10" value="0">
                        </div>
                        <div class="fs-tune-item">
                            <label>Diskussion <span id="fsVal-discussion">0</span></label>
                            <input type="range" id="fsTune-discussion" min="-10" max="10" value="0">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom: Controls (hover to show) -->
        <div class="fs-controls">
            <button class="btn btn-primary fs-start-btn" id="fsStartBtn" onclick="toggleRecording()">
                <span id="fsStartLabel">Stoppa</span>
            </button>
            <div class="fs-phase-bar" id="fsPhaseBar">
                <button class="phase-btn fs-phase-btn" data-phase="none" onclick="setPhase('none')"><img
                        src="icons/pause.png" alt="" class="fs-phase-icon"></button>
                <button class="phase-btn fs-phase-btn" data-phase="lecture" onclick="setPhase('lecture')"><img
                        src="icons/lecture.png" alt="" class="fs-phase-icon"></button>
                <button class="phase-btn fs-phase-btn" data-phase="quiet" onclick="setPhase('quiet')">
                    <svg class="fs-phase-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 3a2.85 2.85 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z" />
                        <path d="m15 5 4 4" />
                    </svg>
                </button>
                <button class="phase-btn fs-phase-btn" data-phase="discussion" onclick="setPhase('discussion')"><img
                        src="icons/discussion.png" alt="" class="fs-phase-icon"></button>
            </div>
        </div>
    </div>
    </div>

    <!-- ===== SESSION REPORT OVERLAY ===== -->
    <div class="report-overlay hidden" id="reportOverlay">
        <div class="report-card">
            <div class="report-header">
                <h2>Sessionsrapport</h2>
                <button class="report-close" onclick="closeReport()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        width="20" height="20">
                        <path d="M18 6 6 18" />
                        <path d="m6 6 12 12" />
                    </svg>
                </button>
            </div>
            <div class="report-meta" id="reportMeta"></div>
            <canvas id="reportGraph" class="report-graph"></canvas>
            <div class="report-stats" id="reportStats"></div>
            <div class="report-phases" id="reportPhases"></div>
            <details class="report-reflection">
                <summary>Reflektion (valfritt)</summary>
                <textarea id="reportReflection" placeholder="Hur upplevde du lektionen?" rows="3"></textarea>
                <button class="btn btn-secondary" onclick="saveReflection()">Spara</button>
            </details>
            <div class="report-actions">
                <button class="btn btn-primary" onclick="closeReport()">Stäng</button>
            </div>
        </div>
    </div>

    <!-- ===== HISTORY OVERLAY ===== -->
    <div class="report-overlay hidden" id="historyOverlay">
        <div class="report-card history-card">
            <div class="report-header">
                <h2>Sessionshistorik</h2>
                <button class="report-close" onclick="closeHistory()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        width="20" height="20">
                        <path d="M18 6 6 18" />
                        <path d="m6 6 12 12" />
                    </svg>
                </button>
            </div>
            <div class="history-list" id="historyList"></div>
            <div class="report-actions">
                <button class="btn btn-primary" onclick="closeHistory()">Stäng</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>